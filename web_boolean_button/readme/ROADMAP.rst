Ported from 12.0 to 13.0
